#!/usr/bin/env bash

set -e

# Using a shell init script to be able to use environment variable substitution
psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" <<-EOSQL
  CREATE TABLE airports (
      code CHAR(3) NOT NULL PRIMARY KEY,
      name VARCHAR(100) NOT NULL,
      city VARCHAR(100) NOT NULL,
      coordinates VARCHAR(100) NOT NULL
  );

  CREATE TABLE flights (
      flight_code CHAR(7) NOT NULL PRIMARY KEY,
      departure_location CHAR(3) NOT NULL,
      arrival_location CHAR(3) NOT NULL,
      departure_date TIMESTAMP NOT NULL,
      arrival_date TIMESTAMP NOT NULL,
      airline_name VARCHAR(100) NOT NULL,
      price DECIMAL(10, 2) NOT NULL,
      FOREIGN KEY (departure_location) REFERENCES airports(code),
      FOREIGN KEY (arrival_location) REFERENCES airports(code)
  );


  INSERT INTO airports (code, name, city, coordinates)
  VALUES
      ('CRV', 'Crotone Airport', 'Crotone', '38.9972, 17.0802'),
      ('BRI', 'Bari Karol Wojtyła Airport', 'Bari', '41.138901, 16.760599'),
      ('FOG', 'Foggia Gino Lisa Airport', 'Foggia', '41.432899, 15.535'),
      ('TAR', 'Taranto-Grottaglie Marcello Arlotta Airport', 'Grottaglie', '40.517502, 17.4032'),
      ('LCC', 'Lecce Galatina Air Base', 'Lecce', '40.239201, 18.133301'),
      ('PSR', 'Pescara International Airport', 'Pescara', '42.431702, 14.1811'),
      ('BDS', 'Brindisi - Salento Airport', 'Brindisi', '40.6576, 17.947001'),
      ('SUF', 'Lamezia Terme Airport', 'Lamezia', '38.905399, 16.2423'),
      ('CTA', 'Catania-Fontanarossa Airport', 'Catania', '37.466801, 15.0664'),
      ('LMP', 'Lampedusa Airport', 'Lampedusa', '35.497898, 12.6181'),
      ('PNL', 'Pantelleria Airport', 'Pantelleria', '36.816502, 11.9689'),
      ('PMO', 'Falcone-Borsellino Airport', 'Palermo', '38.175999, 13.091'),
      ('REG', 'Reggio Calabria Airport', 'Reggio Calabria', '38.071201, 15.6516'),
      ('TPS', 'Vincenzo Florio Airport Trapani-Birgi', 'Trapani', '37.9114, 12.488'),
      ('NSY', 'Sigonella Navy Air Base', 'Sigonella', '37.401699, 14.9224'),
      ('AHO', 'Alghero-Fertilia Airport', 'Alghero', '40.632099, 8.29077'),
      ('DCI', 'Decimomannu Air Base', 'Decimomannu', '39.354198, 8.97248'),
      ('CAG', 'Cagliari Elmas Airport', 'Cagliari', '39.251499, 9.05428'),
      ('OLB', 'Olbia Costa Smeralda Airport', 'Olbia', '40.898701, 9.51763'),
      ('TTB', 'Tortolì Airport', 'Tortoli', '39.9188, 9.68298'),
      ('MXP', 'Malpensa International Airport', 'Milano', '45.6306, 8.72811'),
      ('BGY', 'Il Caravaggio International Airport', 'Bergamo', '45.673901, 9.70417'),
      ('TRN', 'Turin Airport', 'Torino', '45.200802, 7.64963'),
      ('ALL', 'Villanova D''Albenga International Airport', 'Albenga', '44.050598, 8.12743'),
      ('GOA', 'Genoa Cristoforo Colombo Airport', 'Genoa', '44.4133, 8.8375'),
      ('LIN', 'Milano Linate Airport', 'Milan', '45.445099, 9.27674'),
      ('PMF', 'Parma Airport', 'Parma', '44.824501, 10.2964'),
      ('CUF', 'Cuneo International Airport', 'Cuneo', '44.547001, 7.62322'),
      ('AVB', 'Aviano Air Base', 'Aviano', '46.031898, 12.596503'),
      ('BZO', 'Bolzano Airport', 'Bolzano', '46.460201, 11.3264'),
      ('BLQ', 'Bologna Guglielmo Marconi Airport', 'Bologna', '44.5354, 11.2887'),
      ('TSF', 'Treviso-Sant''Angelo Airport', 'Treviso', '45.648399, 12.1944'),
      ('FRL', 'Forlì Airport', 'Forli', '44.194801, 12.0701'),
      ('VBS', 'Brescia Airport', 'Brescia', '45.428902, 10.3306'),
      ('TRS', 'Trieste-Friuli Venezia Giulia Airport', 'Ronchi De Legionari', '45.827499, 13.4722'),
      ('RMI', 'Federico Fellini International Airport', 'Rimini', '44.020302, 12.6117'),
      ('VIC', 'Vicenza Airport', 'Vicenza', '45.573399, 11.5295'),
      ('QPA', 'Padova Airport', 'Padova', '45.395802, 11.8479'),
      ('VRN', 'Verona Villafranca Airport', 'Villafranca', '45.395699, 10.8885'),
      ('VCE', 'Venice Marco Polo Airport', 'Venice', '45.505299, 12.3519'),
      ('SAY', 'Siena-Ampugnano Airport', 'Siena', '43.256302, 11.255'),
      ('CIA', 'Ciampino-G. B. Pastine International Airport', 'Rome', '41.7994, 12.5949'),
      ('FCO', 'Leonardo da Vinci-Fiumicino Airport', 'Rome', '41.8002778, 12.2388889'),
      ('EBA', 'Marina Di Campo Airport', 'Marina Di Campo', '42.7603, 10.2394'),
      ('QLT', 'Latina Air Base', 'Latina', '41.5424, 12.909'),
      ('NAP', 'Naples International Airport', 'Naples', '40.886002, 14.2908'),
      ('PSA', 'Pisa International Airport', 'Pisa', '43.683899, 10.3927'),
      ('FLR', 'Peretola Airport', 'Florence', '43.810001, 11.2051'),
      ('GRS', 'Grosseto Air Base', 'Grosseto', '42.759701, 11.0719'),
      ('PEG', 'Perugia San Francesco d''Assisi - Umbria International Airport', 'Perugia', '43.095901, 12.5132'),
      ('AOI', 'Ancona Falconara Airport', 'Ancona', '43.616299, 13.3623'),
      ('AOT', 'Aosta Airport', 'Aosta', '45.738499, 7.36872'),
      ('QSR', 'Salerno Costa d''Amalfi Airport', 'Salerno', '40.620399, 14.9113'),
      ('FNU', 'Oristano-Fenosu Airport', 'Oristano', '39.895308, 8.642661'),
      ('CIY', 'Comiso Airport', 'Comiso', '36.994601, 14.607182'),
      ('QLP', 'Sarzana-Luni Air Base', 'Sarzana (SP)', '44.088001, 9.98795'),
      ('YYZ', 'Lester B. Pearson International Airport', 'Toronto', '43.6772003174, -79.63059997559999'),
      ('FRA', 'Frankfurt am Main Airport', 'Frankfurt', '50.033333, 8.570556'),
      ('LHR', 'London Heathrow Airport', 'London', '51.4706, -0.461941'),
      ('AMS', 'Amsterdam Airport Schiphol', 'Amsterdam', '52.308601, 4.76389'),
      ('BCN', 'Barcelona International Airport', 'Barcelona', '41.2971, 2.07846'),
      ('MAD', 'Adolfo Suárez Madrid-Barajas Airport', 'Madrid', '40.471926, -3.56264'),
      ('CDG', 'Charles de Gaulle International Airport', 'Paris', '49.012798, 2.55'),
      ('DXB', 'Dubai International Airport', 'Dubai', '25.2527999878, 55.3643989563'),
      ('HND', 'Tokyo Haneda International Airport', 'Tokyo', '35.552299, 139.779999'),
      ('SIN', 'Singapore Changi Airport', 'Singapore', '1.35019, 103.994003'),
      ('PEK', 'Beijing Capital International Airport', 'Beijing', '40.0801010131836, 116.58499908447266'),
      ('SFO', 'San Francisco International Airport', 'San Francisco', '37.61899948120117, -122.375'),
      ('LAX', 'Los Angeles International Airport', 'Los Angeles', '33.94250107, -118.4079971'),
      ('SEA', 'Seattle Tacoma International Airport', 'Seattle', '47.449001, -122.308998'),
      ('DFW', 'Dallas Fort Worth International Airport', 'Dallas-Fort Worth', '32.896801, -97.038002'),
      ('ATL', 'Hartsfield Jackson Atlanta International Airport', 'Atlanta', '33.6367, -84.428101'),
      ('DEN', 'Denver International Airport', 'Denver', '39.861698150635, -104.672996521'),
      ('JFK', 'John F Kennedy International Airport', 'New York', '40.63980103, -73.77890015'),
      ('ORD', 'Chicago O''Hare International Airport', 'Chicago', '41.9786, -87.9048'),
      ('BKK', 'Suvarnabhumi Airport', 'Bangkok', '13.681099891662598, 100.74700164794922');


  INSERT INTO flights (flight_code, departure_location, arrival_location, departure_date, arrival_date, airline_name, price)
  VALUES
      ('${AIRLINE_PREFIX}41300', 'AMS', 'FRA', '2025-05-11 08:00:00', '2025-05-11 10:00:00', '${AIRLINE_NAME}', 435.00),
      ('${AIRLINE_PREFIX}64300', 'FRA', 'LHR', '2025-06-19 08:00:00', '2025-06-19 10:00:00', '${AIRLINE_NAME}', 625.00),
      ('${AIRLINE_PREFIX}18300', 'LHR', 'FRA', '2025-07-11 08:00:00', '2025-07-11 10:00:00', '${AIRLINE_NAME}', 345.00),
      ('${AIRLINE_PREFIX}11100', 'FRA', 'LHR', '2025-08-19 08:00:00', '2025-08-19 10:00:00', '${AIRLINE_NAME}', 389.00),
      ('${AIRLINE_PREFIX}11400', 'LHR', 'FRA', '2025-09-11 08:00:00', '2025-09-11 10:00:00', '${AIRLINE_NAME}', 735.00),
      ('${AIRLINE_PREFIX}11200', 'FRA', 'LHR', '2025-09-19 08:00:00', '2025-09-19 10:00:00', '${AIRLINE_NAME}', 654.00),
      ('${AIRLINE_PREFIX}27821', 'FCO', 'CAG', '2025-01-04 08:00:00', '2025-01-04 09:00:00', '${AIRLINE_NAME}', 587.74),
      ('${AIRLINE_PREFIX}59703', 'HND', 'NSY', '2025-07-12 22:00:00', '2025-07-13 01:00:00', '${AIRLINE_NAME}', 811.80),
      ('${AIRLINE_PREFIX}48898', 'TRS', 'QPA', '2025-03-27 10:00:00', '2025-03-27 14:00:00', '${AIRLINE_NAME}', 806.42),
      ('${AIRLINE_PREFIX}63525', 'NAP', 'VCE', '2025-09-27 00:00:00', '2025-09-27 02:00:00', '${AIRLINE_NAME}', 525.78),
      ('${AIRLINE_PREFIX}33252', 'BRI', 'DXB', '2025-03-18 01:00:00', '2025-03-18 05:00:00', '${AIRLINE_NAME}', 322.52),
      ('${AIRLINE_PREFIX}25060', 'REG', 'SFO', '2025-06-19 20:00:00', '2025-06-19 23:00:00', '${AIRLINE_NAME}', 661.64),
      ('${AIRLINE_PREFIX}65796', 'HND', 'VCE', '2025-03-05 22:00:00', '2025-03-06 02:00:00', '${AIRLINE_NAME}', 818.77),
      ('${AIRLINE_PREFIX}06798', 'NSY', 'BLQ', '2025-12-15 10:00:00', '2025-12-15 13:00:00', '${AIRLINE_NAME}', 103.84),
      ('${AIRLINE_PREFIX}48188', 'SUF', 'PEG', '2025-12-12 14:00:00', '2025-12-12 16:00:00', '${AIRLINE_NAME}', 347.77),
      ('${AIRLINE_PREFIX}23092', 'AOI', 'AHO', '2025-11-13 08:00:00', '2025-11-13 10:00:00', '${AIRLINE_NAME}', 868.23),
      ('${AIRLINE_PREFIX}84117', 'EBA', 'FCO', '2025-04-07 14:00:00', '2025-04-07 16:00:00', '${AIRLINE_NAME}', 113.62),
      ('${AIRLINE_PREFIX}53040', 'ALL', 'PSA', '2025-11-28 10:00:00', '2025-11-28 12:00:00', '${AIRLINE_NAME}', 715.42),
      ('${AIRLINE_PREFIX}18156', 'PSR', 'CTA', '2025-09-06 01:00:00', '2025-09-06 02:00:00', '${AIRLINE_NAME}', 268.24),
      ('${AIRLINE_PREFIX}58302', 'LCC', 'CDG', '2025-02-01 00:00:00', '2025-02-01 03:00:00', '${AIRLINE_NAME}', 838.01),
      ('${AIRLINE_PREFIX}63462', 'TPS', 'ATL', '2025-01-29 09:00:00', '2025-01-29 11:00:00', '${AIRLINE_NAME}', 866.86),
      ('${AIRLINE_PREFIX}97097', 'FOG', 'LHR', '2025-10-08 04:00:00', '2025-10-08 07:00:00', '${AIRLINE_NAME}', 54.80),
      ('${AIRLINE_PREFIX}48311', 'VCE', 'CTA', '2025-12-04 19:00:00', '2025-12-04 23:00:00', '${AIRLINE_NAME}', 350.26),
      ('${AIRLINE_PREFIX}63195', 'FLR', 'CIY', '2025-08-25 23:00:00', '2025-08-26 00:00:00', '${AIRLINE_NAME}', 474.74),
      ('${AIRLINE_PREFIX}78716', 'QSR', 'FLR', '2025-08-05 22:00:00', '2025-08-06 02:00:00', '${AIRLINE_NAME}', 427.19),
      ('${AIRLINE_PREFIX}43108', 'AVB', 'FRL', '2025-07-10 20:00:00', '2025-07-10 22:00:00', '${AIRLINE_NAME}', 55.31),
      ('${AIRLINE_PREFIX}37138', 'VCE', 'JFK', '2025-09-12 17:00:00', '2025-09-12 19:00:00', '${AIRLINE_NAME}', 452.21),
      ('${AIRLINE_PREFIX}78341', 'AHO', 'BLQ', '2025-05-06 17:00:00', '2025-05-06 21:00:00', '${AIRLINE_NAME}', 64.47),
      ('${AIRLINE_PREFIX}99397', 'CIA', 'TTB', '2025-06-12 03:00:00', '2025-06-12 07:00:00', '${AIRLINE_NAME}', 854.10),
      ('${AIRLINE_PREFIX}19844', 'REG', 'FRA', '2025-11-11 03:00:00', '2025-11-11 04:00:00', '${AIRLINE_NAME}', 693.39),
      ('${AIRLINE_PREFIX}74850', 'AHO', 'FNU', '2025-10-16 22:00:00', '2025-10-17 01:00:00', '${AIRLINE_NAME}', 391.61),
      ('${AIRLINE_PREFIX}12247', 'BGY', 'PSA', '2025-11-12 19:00:00', '2025-11-12 21:00:00', '${AIRLINE_NAME}', 419.71),
      ('${AIRLINE_PREFIX}71532', 'LCC', 'VIC', '2025-06-18 09:00:00', '2025-06-18 13:00:00', '${AIRLINE_NAME}', 765.39),
      ('${AIRLINE_PREFIX}24378', 'GRS', 'BCN', '2025-12-14 13:00:00', '2025-12-14 15:00:00', '${AIRLINE_NAME}', 673.03),
      ('${AIRLINE_PREFIX}28536', 'AHO', 'TRN', '2025-08-24 17:00:00', '2025-08-24 21:00:00', '${AIRLINE_NAME}', 642.56),
      ('${AIRLINE_PREFIX}06528', 'FNU', 'BLQ', '2025-10-08 01:00:00', '2025-10-08 05:00:00', '${AIRLINE_NAME}', 106.29),
      ('${AIRLINE_PREFIX}50538', 'VRN', 'PEK', '2025-07-15 04:00:00', '2025-07-15 07:00:00', '${AIRLINE_NAME}', 854.98),
      ('${AIRLINE_PREFIX}82709', 'DFW', 'ATL', '2025-11-18 09:00:00', '2025-11-18 12:00:00', '${AIRLINE_NAME}', 802.73),
      ('${AIRLINE_PREFIX}61208', 'QLT', 'PMO', '2025-04-06 01:00:00', '2025-04-06 02:00:00', '${AIRLINE_NAME}', 556.33),
      ('${AIRLINE_PREFIX}80960', 'GOA', 'VIC', '2025-10-20 09:00:00', '2025-10-20 10:00:00', '${AIRLINE_NAME}', 204.66),
      ('${AIRLINE_PREFIX}34672', 'AOT', 'FNU', '2025-11-29 22:00:00', '2025-11-30 00:00:00', '${AIRLINE_NAME}', 820.33),
      ('${AIRLINE_PREFIX}60625', 'FRA', 'PSA', '2025-01-06 21:00:00', '2025-01-06 22:00:00', '${AIRLINE_NAME}', 166.96),
      ('${AIRLINE_PREFIX}84874', 'PMF', 'TTB', '2025-03-22 19:00:00', '2025-03-22 22:00:00', '${AIRLINE_NAME}', 117.07),
      ('${AIRLINE_PREFIX}91927', 'EBA', 'CAG', '2025-08-17 15:00:00', '2025-08-17 16:00:00', '${AIRLINE_NAME}', 352.00),
      ('${AIRLINE_PREFIX}04613', 'AVB', 'ATL', '2025-06-09 02:00:00', '2025-06-09 03:00:00', '${AIRLINE_NAME}', 90.80),
      ('${AIRLINE_PREFIX}36034', 'VCE', 'DXB', '2025-06-01 10:00:00', '2025-06-01 12:00:00', '${AIRLINE_NAME}', 422.07),
      ('${AIRLINE_PREFIX}95580', 'PNL', 'AOT', '2025-04-14 11:00:00', '2025-04-14 13:00:00', '${AIRLINE_NAME}', 261.35),
      ('${AIRLINE_PREFIX}04441', 'PEG', 'SAY', '2025-08-16 22:00:00', '2025-08-16 23:00:00', '${AIRLINE_NAME}', 615.89),
      ('${AIRLINE_PREFIX}13016', 'REG', 'TRN', '2025-05-13 01:00:00', '2025-05-13 04:00:00', '${AIRLINE_NAME}', 373.81),
      ('${AIRLINE_PREFIX}93266', 'ATL', 'SAY', '2025-10-15 14:00:00', '2025-10-15 17:00:00', '${AIRLINE_NAME}', 132.95),
      ('${AIRLINE_PREFIX}14234', 'CDG', 'PSR', '2025-05-18 17:00:00', '2025-05-18 19:00:00', '${AIRLINE_NAME}', 852.87),
      ('${AIRLINE_PREFIX}79041', 'BDS', 'FNU', '2025-09-15 13:00:00', '2025-09-15 15:00:00', '${AIRLINE_NAME}', 438.92),
      ('${AIRLINE_PREFIX}98896', 'NSY', 'ATL', '2025-03-30 15:00:00', '2025-03-30 17:00:00', '${AIRLINE_NAME}', 809.34),
      ('${AIRLINE_PREFIX}77715', 'QLT', 'BGY', '2025-07-14 12:00:00', '2025-07-14 16:00:00', '${AIRLINE_NAME}', 315.12),
      ('${AIRLINE_PREFIX}32246', 'PNL', 'FRA', '2025-03-11 13:00:00', '2025-03-11 17:00:00', '${AIRLINE_NAME}', 211.01),
      ('${AIRLINE_PREFIX}97745', 'TSF', 'BDS', '2025-07-15 11:00:00', '2025-07-15 15:00:00', '${AIRLINE_NAME}', 586.93),
      ('${AIRLINE_PREFIX}12345', 'BLQ', 'PMO', '2025-05-15 10:00:00', '2025-05-15 12:00:00', '${AIRLINE_NAME}', 123.45),
      ('${AIRLINE_PREFIX}67890', 'PMO', 'BLQ', '2025-06-15 10:00:00', '2025-06-15 12:00:00', '${AIRLINE_NAME}', 678.90),
      ('${AIRLINE_PREFIX}24680', 'BLQ', 'PMO', '2025-07-15 10:00:00', '2025-07-15 12:00:00', '${AIRLINE_NAME}', 246.80),
      ('${AIRLINE_PREFIX}13579', 'PMO', 'BLQ', '2025-08-15 10:00:00', '2025-08-15 12:00:00', '${AIRLINE_NAME}', 135.79),
      ('${AIRLINE_PREFIX}98765', 'BLQ', 'PMO', '2025-09-15 10:00:00', '2025-09-15 12:00:00', '${AIRLINE_NAME}', 987.65);

EOSQL